FROM maven:3.8.1-jdk-8 as builder
ARG PATCH
WORKDIR /app
COPY ./my-app .
RUN mvn versions:set -DnewVersion=1.0.$PATCH
RUN mvn -B  clean package 
RUN mkdir artifact && cp target/*.jar artifact

FROM fabric8/java-alpine-openjdk8-jre
WORKDIR /app
#copy application jar (with libraries inside)
COPY --from=builder app/target/my-app*.jar ./my-app.jar
CMD ["/usr/bin/java", "-jar", "/app/my-app.jar"]

#FROM builder
#COPY my-app/target/my-app*.jar ./my-app.jar
#CMD ["/usr/bin/java", "-jar", "/app/my-app.jar"]

#FROM builder
#RUN docker run liorberi/my-app:1.0.${{ github.run_number }}
